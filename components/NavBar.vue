<template>
  <nav>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="487"
      height="77"
      viewBox="0 0 487 77"
      fill="none"
      class="w-full md:px-0 px-4"
    >
      <g id="Group 73">
        <path
          id="nav-left"
          d="M210.043 62.225H9.12252C6.18314 62.225 4.67701 61.3018 3.81365 60.019C2.86369 58.6075 2.4732 56.4532 2.50144 53.5721C2.52814 50.8484 2.91917 47.7408 3.33607 44.4278C3.35504 44.277 3.37407 44.1258 3.39311 43.9742C3.82505 40.5363 4.26469 36.9089 4.26469 33.5056C4.26469 30.0781 3.82044 27.2333 3.37792 24.9277C3.25849 24.3055 3.14392 23.7408 3.03924 23.2249C2.73892 21.7447 2.51999 20.6657 2.50117 19.7789C2.48952 19.2296 2.56672 18.9224 2.65961 18.7375C2.73692 18.5837 2.8778 18.4061 3.24417 18.2215C4.10381 17.7884 5.81343 17.5 9.12252 17.5H209.384C210.019 17.5 210.605 17.8974 210.944 18.6462C211.289 19.4072 211.254 20.2908 210.834 20.9298C207.359 26.2205 205.34 32.5271 205.34 39.2944C205.34 46.4708 207.61 53.1286 211.48 58.6063C211.932 59.2458 211.994 60.1755 211.642 60.9964C211.296 61.8063 210.687 62.225 210.043 62.225Z"
          fill="#D8CBCF"
          stroke="#006838"
          stroke-width="3"
        />
        <path
          id="nav-right"
          d="M276.888 58.6063C280.757 53.1286 283.027 46.4708 283.027 39.2944C283.027 32.5271 281.009 26.2205 277.533 20.9298C277.114 20.2908 277.079 19.4072 277.424 18.6461C277.763 17.8974 278.348 17.5 278.984 17.5H479.245C482.231 17.5 483.626 18.3798 484.363 19.5087C485.189 20.7759 485.464 22.7509 485.295 25.5022C485.154 27.7936 484.73 30.3725 484.27 33.1637C484.185 33.6788 484.099 34.2012 484.014 34.7303C483.472 38.0752 482.955 41.6452 482.955 45.0724C482.955 48.5211 483.477 51.4546 484.032 53.8811C484.216 54.6867 484.409 55.4573 484.585 56.1586C484.67 56.4969 484.75 56.8191 484.824 57.1213C485.059 58.0817 485.227 58.859 485.302 59.5112C485.377 60.1684 485.341 60.5779 485.256 60.8414C485.188 61.0547 485.073 61.2296 484.802 61.4062C484.488 61.6099 483.943 61.8271 483.004 61.9848C482.075 62.141 480.85 62.225 479.245 62.225H278.325C277.681 62.225 277.072 61.8063 276.725 60.9964C276.374 60.1755 276.436 59.2458 276.888 58.6063Z"
          fill="#D8CBCF"
          stroke="#006838"
          stroke-width="3"
        />
        <path
          id="nav-sun"
          d="M275.406 39.3848C275.406 56.4176 261.349 70.2697 243.953 70.2697C226.557 70.2697 212.5 56.4176 212.5 39.3848C212.5 22.3521 226.557 8.5 243.953 8.5C261.349 8.5 275.406 22.3521 275.406 39.3848Z"
          fill="#FF6B00"
          stroke="#006838"
          stroke-width="3"
        />
        <path
          id="nav-plant"
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M241.016 21.2468C241.946 20.6858 242.878 20.1238 243.671 19.3629C244.719 20.3669 245.956 20.5772 247.381 20.8195L247.608 20.858C250.73 21.4467 251.861 23.6655 253.037 26.3823C254.576 29.9595 257.879 31.3632 261.68 31.4991C262.042 31.4991 262.358 31.1368 262.223 30.7746C261.535 29.0017 261.543 27.1669 261.551 25.3244C261.556 24.0141 261.562 22.7 261.318 21.4014C260.852 19.0352 259.677 17.2084 258.444 15.2916C258.12 14.7874 257.792 14.277 257.472 13.7489C256.521 12.2094 256.34 10.8057 256.386 8.99442C256.389 8.89696 256.393 8.79949 256.398 8.70205L256.398 8.70132L256.398 8.70058L256.398 8.69984L256.398 8.6991C256.443 7.62053 256.487 6.54515 256.114 5.50778C255.3 3.37958 253.309 3.01733 251.318 2.70036C251.176 2.67846 251.033 2.65921 250.892 2.64004C250.448 2.57995 250.01 2.52072 249.599 2.38339C248.844 2.16312 248.395 1.76791 247.903 1.33453C247.687 1.14428 247.463 0.946669 247.2 0.753277C246.522 0.255186 246.024 -0.107062 245.119 0.0287806C243.128 0.391029 240.64 2.8362 239.78 4.55688C238.83 6.36812 238.875 8.36049 240.142 9.9906C240.504 10.448 240.954 10.8412 241.407 11.2378L241.407 11.2378C242.032 11.7834 242.664 12.3355 243.083 13.0697C243.869 14.4252 244.276 16.9629 243.162 18.2773C243.12 18.3005 243.078 18.3304 243.037 18.3677C242.21 19.1956 241.222 19.8011 240.229 20.41C239.32 20.9668 238.407 21.5266 237.608 22.2619C235.979 23.7109 234.712 25.6579 233.852 27.6503C231.771 32.2237 231.183 37.2499 231.816 42.2308C232.16 44.8531 232.86 47.3835 233.559 49.9093C234.333 52.7045 235.105 55.4941 235.391 58.3961C235.707 61.5205 235.888 64.8713 235.255 67.9504C234.884 69.7467 234.263 71.4712 233.639 73.2029C233.272 74.2214 232.904 75.2425 232.585 76.2821C232.404 76.916 233.309 77.2783 233.626 76.7349C233.652 76.6832 233.674 76.6347 233.694 76.588L233.716 76.5991C234.038 75.5374 234.416 74.4916 234.793 73.4484C235.316 72 235.837 70.5565 236.205 69.0824C236.838 66.5467 236.884 63.9657 236.748 61.3847C236.547 57.4249 235.625 53.7884 234.682 50.0697C234.353 48.7706 234.021 47.4614 233.716 46.125C232.449 40.6912 232.314 35.1217 234.214 29.8238C235.119 27.3333 236.477 24.8882 238.422 23.0769C239.198 22.3441 240.106 21.7959 241.016 21.2468L241.016 21.2468Z"
          fill="#006838"
        />
        <g xmlns="http://www.w3.org/2000/svg" id="nav-text">
          <defs>
            <linearGradient
              id="services-gradient"
              x1="0%"
              y1="0%"
              x2="0%"
              y2="100%"
            >
              <stop offset="100%" stop-color="#006838" />
              <stop offset="100%" stop-color="#FF6B00" />
            </linearGradient>
            <linearGradient
              id="contact-gradient"
              x1="0%"
              y1="0%"
              x2="0%"
              y2="100%"
            >
              <stop offset="100%" stop-color="#006838" />
              <stop offset="100%" stop-color="#FF6B00" />
            </linearGradient>
            <linearGradient
              id="work-gradient"
              x1="0%"
              y1="0%"
              x2="0%"
              y2="100%"
            >
              <stop offset="100%" stop-color="#006838" />
              <stop offset="100%" stop-color="#FF6B00" />
            </linearGradient>
            <linearGradient
              id="index-gradient"
              x1="0%"
              y1="0%"
              x2="0%"
              y2="100%"
            >
              <stop offset="100%" stop-color="#006838" />
              <stop offset="100%" stop-color="#FF6B00" />
            </linearGradient>
          </defs>
          <NuxtLink to="services">
            <g
              id="service-group"
              class="cursor-pointer"
              @mouseover="hoverText('services')"
              @mouseleave="removeHover('services')"
              @click="runWordTween('services')"
            >
              <rect
                id="services-rect"
                x="105"
                y="20"
                width="81"
                height="40"
                fill="#D8CBCF"
              />
              <text
                id="nav-services"
                fill="url(#services-gradient)"
                xml:space="preserve"
                style="white-space: pre"
                font-family="Minipax"
                font-size="18"
                font-weight="bold"
                letter-spacing="0em"
              >
                <tspan x="106.423" y="44.5">services</tspan>
              </text>
            </g>
          </NuxtLink>
          <NuxtLink to="contact">
            <g
              id="contact-group"
              class="cursor-pointer"
              @mouseover="hoverText('contact')"
              @mouseleave="removeHover('contact')"
              @click="runWordTween('contact')"
            >
              <rect
                id="contact-rect"
                x="391"
                y="20"
                width="82"
                height="40"
                fill="#D8CBCF"
              />
              <text
                id="nav-contact"
                fill="url(#contact-gradient)"
                xml:space="preserve"
                style="white-space: pre"
                font-family="Minipax"
                font-size="18"
                font-weight="bold"
                letter-spacing="0em"
              >
                <tspan x="394.437" y="44.5">contact</tspan>
              </text>
            </g>
          </NuxtLink>
          <NuxtLink to="work">
            <g
              id="work-group"
              class="cursor-pointer"
              @mouseover="hoverText('work')"
              @mouseleave="removeHover('work')"
              @click="runWordTween('work')"
            >
              >
              <rect
                id="work-rect"
                x="303"
                y="20"
                width="60"
                height="40"
                fill="#D8CBCF"
              />
              <text
                id="nav-work"
                fill="url(#work-gradient)"
                xml:space="preserve"
                style="white-space: pre"
                font-family="Minipax"
                font-size="18"
                font-weight="bold"
                letter-spacing="0em"
              >
                <tspan x="305.598" y="44.5">work</tspan>
              </text>
            </g>
          </NuxtLink>
          <NuxtLink to="/">
            <g
              id="index-group"
              class="cursor-pointer"
              @mouseover="hoverText('index')"
              @mouseleave="removeHover('index')"
              @click="runWordTween('index')"
            >
              <rect
                id="index-rect"
                x="17"
                y="20"
                width="70"
                height="40"
                fill="#D8CBCF"
              />
              <text
                id="nav-index"
                fill="url(#index-gradient)"
                xml:space="preserve"
                style="white-space: pre"
                font-family="Minipax"
                font-size="18"
                font-weight="bold"
                letter-spacing="0em"
              >
                <tspan x="22.9795" y="45.5">home</tspan>
              </text>
            </g>
          </NuxtLink>
        </g>
      </g>
    </svg>
  </nav>
</template>
<script>
import { mapState } from 'vuex'

export default {
  mounted() {
    //run tween initially, will run one changed with watch after
    this.runWordTween(this.page)
    window.addEventListener('scroll', this.onScroll)
  },
  beforeDestroy() {
    window.removeEventListener('scroll', this.onScroll)
  },
  computed: {
    ...mapState(['page']),
    navTween() {
      return gsap.to('nav', {
        y: -100,
        ease: 'elastic.in(1, 0.5)',
        duration: 1.4,
      })
    },
  },
  data() {
    return {
      showNavbar: true,
      lastScrollPosition: 0,
    }
  },
  watch: {
    page(newVal, oldVal) {
      if (oldVal) {
        this.stopWordTween(oldVal)
      }
      this.runWordTween(newVal)
    },
  },
  methods: {
    gradientId(pageName) {
      return `#${pageName}-gradient stop`
    },
    textId(pageName) {
      return `#nav-${pageName}`
    },
    hoverText(pageName) {
      if (pageName !== this.page) this.runWordTween(pageName)
    },
    removeHover(pageName) {
      if (pageName !== this.page) this.stopWordTween(pageName)
    },
    runWordTween(pageName) {
      let tl = gsap.getById(pageName)
      if (tl) {
        tl.play()
      } else {
        let tl = gsap.timeline({ id: pageName })

        tl.to(this.gradientId(pageName), {
          attr: { offset: '0%' },
          duration: 0.5,
          ease: 'none',
        })
        tl.to(this.textId(pageName), {
          yoyo: true,
          repeat: -1,
          duration: 0.5,
          y: 3,
          rotation: -6,
          transformOrigin: 'middle middle',
          ease: Linear.easeNone,
        })
      }
    },
    stopWordTween(pageName) {
      // if (
      //   gsap.isTweening(this.textId(pageName)) ||
      //   gsap.isTweening(this.gradientId(pageName))
      // ) {
      let timeline = gsap.getById(pageName)
      if (timeline) timeline.reverse(0.8)
      // }
    },
    onScroll() {
      if (window.innerWidth <= 768) {
        if (this.showNavbar) return
        else {
          this.showNavbar = true
          this.navTween.reverse()
        }
      }
      const currentScrollPosition =
        window.pageYOffset || document.documentElement.scrollTop
      if (currentScrollPosition < 0) {
        return
      }
      // Stop executing this function if the difference between
      // current scroll position and last scroll position is less than some offset
      if (Math.abs(currentScrollPosition - this.lastScrollPosition) < 60) {
        return
      }
      this.showNavbar = currentScrollPosition < this.lastScrollPosition
      this.lastScrollPosition = currentScrollPosition

      if (!this.showNavbar) {
        this.navTween.play()
      } else {
        this.navTween.reverse()
      }
    },
  },
}
</script>
<style lang="scss">
tspan {
  pointer-events: none;
}
</style>
